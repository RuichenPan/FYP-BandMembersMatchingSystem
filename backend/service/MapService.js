import BaseService from './BaseService';
import querystring from 'querystring';
import requestApi from 'request';

class MapService extends BaseService {
  async ApiRequest(url, params) {
    const opt = Object.assign({}, { ...params }, { });

    const headers = {
      Accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
      'content-type': 'application/json; charset=UTF-8',
      'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1',
      'X-Requested-With': 'XMLHttpRequest',
      origin: 'https://rawgit.com',
      referer: 'https://rawgit.com/',
    };

    const options = {
      method: 'get',
      url: `${url}?${querystring.stringify(opt)}`,
      headers,
    };

    console.log('url:', options.url);
    return new Promise((resolve, reject) => {
      requestApi(options, (error, res, body) => {
        if (error) {
          reject(error);
        } else {
          resolve(JSON.parse(body));
        }
      });
    });
  }

  async reverse({ lat, lon }) {
    return this.ApiRequest('https://nominatim.openstreetmap.org/reverse', {geojson:0, lat, lon, zoom: 13, format: 'jsonv2' });
    return {
      place_id: 257841922,
      licence: 'Data © OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright',
      osm_type: 'relation',
      osm_id: 4197888,
      lat: '53.2729511',
      lon: '-7.492834171490187',
      display_name: 'Tullamore Urban ED, The Municipal District of Tullamore, County Offaly, Leinster, Éire / Ireland',
      address: {
        city_district: 'Tullamore Urban ED',
        region: 'The Municipal District of Tullamore',
        county: 'County Offaly',
        state_district: 'Leinster',
        country: 'Éire / Ireland',
        country_code: 'ie',
      },
      extratags: {},
      boundingbox: ['53.2568607', '53.2890662', '-7.521057', '-7.4688325'],
      geojson: {
        type: 'Polygon',
        coordinates: [
          [
            [-7.521057, 53.2704556],
            [-7.512241, 53.2705872],
            [-7.5097107, 53.2666483],
            [-7.5097107, 53.2666098],
            [-7.5092118, 53.2659441],
            [-7.5088719, 53.2655228],
            [-7.508139, 53.265806],
            [-7.5080474, 53.265848],
            [-7.5071503, 53.2662599],
            [-7.5048456, 53.2632367],
            [-7.5043022, 53.2633866],
            [-7.5040885, 53.2633373],
            [-7.5031524, 53.262511],
            [-7.5025613, 53.2622887],
            [-7.5024451, 53.261972],
            [-7.5025355, 53.2618329],
            [-7.5014376, 53.2609752],
            [-7.5005592, 53.2600133],
            [-7.4997971, 53.2588774],
            [-7.4995, 53.2578189],
            [-7.4994613, 53.2568607],
            [-7.4957154, 53.2574711],
            [-7.4959221, 53.2583675],
            [-7.4943979, 53.2585993],
            [-7.4924345, 53.2591402],
            [-7.4844725, 53.2598207],
            [-7.4844335, 53.2596747],
            [-7.4843551, 53.2594912],
            [-7.4843007, 53.2593641],
            [-7.4839933, 53.2589321],
            [-7.4838339, 53.2586947],
            [-7.4828107, 53.2588508],
            [-7.481586, 53.2590199],
            [-7.4793146, 53.2592949],
            [-7.476775, 53.2596521],
            [-7.4751735, 53.259863],
            [-7.4725992, 53.2601687],
            [-7.4731267, 53.2621562],
            [-7.4725168, 53.2622351],
            [-7.4717072, 53.2623336],
            [-7.4719478, 53.2627852],
            [-7.4719575, 53.2628034],
            [-7.4722337, 53.2632009],
            [-7.4723201, 53.263583],
            [-7.4723891, 53.2639134],
            [-7.4715691, 53.2640425],
            [-7.4709994, 53.2641302],
            [-7.4711893, 53.2646104],
            [-7.471267, 53.2650182],
            [-7.4712853, 53.2650894],
            [-7.4713404, 53.2652018],
            [-7.4717377, 53.2659677],
            [-7.4717912, 53.2660777],
            [-7.4718924, 53.266395],
            [-7.4718732, 53.2676831],
            [-7.4718326, 53.267905],
            [-7.4712738, 53.2686966],
            [-7.4722416, 53.268955],
            [-7.4727128, 53.2690804],
            [-7.4740673, 53.2694409],
            [-7.4743552, 53.269518],
            [-7.474854, 53.2696517],
            [-7.4751711, 53.2697367],
            [-7.4752154, 53.2697485],
            [-7.475994, 53.269956],
            [-7.4762, 53.270011],
            [-7.4766, 53.270122],
            [-7.4766319, 53.2701303],
            [-7.4763569, 53.2704088],
            [-7.4737607, 53.2728854],
            [-7.4737198, 53.2729244],
            [-7.473871, 53.2730816],
            [-7.4744272, 53.2733786],
            [-7.4750761, 53.2735845],
            [-7.4761224, 53.2739502],
            [-7.4773855, 53.2743648],
            [-7.4779303, 53.2745534],
            [-7.4783747, 53.2746877],
            [-7.4783422, 53.2747535],
            [-7.4773575, 53.276744],
            [-7.4769947, 53.2774774],
            [-7.4767322, 53.27817],
            [-7.4766846, 53.2782955],
            [-7.4765069, 53.2787642],
            [-7.4764629, 53.2788898],
            [-7.4763434, 53.2791956],
            [-7.4763102, 53.2792831],
            [-7.4760142, 53.2796094],
            [-7.4745528, 53.2797698],
            [-7.4744913, 53.279969],
            [-7.4744418, 53.2801292],
            [-7.4740625, 53.2802896],
            [-7.474044, 53.2804998],
            [-7.4732486, 53.2807265],
            [-7.4726196, 53.2808039],
            [-7.4722774, 53.2807874],
            [-7.4716982, 53.2810216],
            [-7.4713194, 53.2811471],
            [-7.4712443, 53.281176],
            [-7.4707621, 53.2815268],
            [-7.4706569, 53.2816025],
            [-7.4705442, 53.2816282],
            [-7.4703082, 53.2816972],
            [-7.4700272, 53.2817609],
            [-7.4697985, 53.2817441],
            [-7.4695127, 53.2818204],
            [-7.4688325, 53.2822583],
            [-7.4710301, 53.2833532],
            [-7.4756777, 53.2852682],
            [-7.4758608, 53.2852604],
            [-7.476371, 53.2853464],
            [-7.4780192, 53.2858626],
            [-7.4803214, 53.2863161],
            [-7.4827021, 53.2868635],
            [-7.4839317, 53.2870238],
            [-7.4845838, 53.2870687],
            [-7.4867724, 53.2875638],
            [-7.4868357, 53.287579],
            [-7.4873458, 53.2875712],
            [-7.4878952, 53.2877042],
            [-7.4910346, 53.2885682],
            [-7.4931964, 53.2885313],
            [-7.4944453, 53.28851],
            [-7.4952494, 53.2884963],
            [-7.4955329, 53.2887325],
            [-7.4957128, 53.2888837],
            [-7.4958253, 53.2889783],
            [-7.4959238, 53.2890662],
            [-7.4960777, 53.2890192],
            [-7.4961886, 53.2889993],
            [-7.4963745, 53.288993],
            [-7.4964559, 53.2889889],
            [-7.4966478, 53.2889793],
            [-7.498923, 53.2889289],
            [-7.500724, 53.2888933],
            [-7.501198, 53.2888839],
            [-7.5015503, 53.2888749],
            [-7.5020258, 53.2888315],
            [-7.5048507, 53.2887637],
            [-7.50506, 53.2885292],
            [-7.5050306, 53.2880948],
            [-7.5053495, 53.2880074],
            [-7.5057926, 53.2879489],
            [-7.5060155, 53.2879287],
            [-7.5062484, 53.287903],
            [-7.5081878, 53.2878053],
            [-7.5101951, 53.2877261],
            [-7.5102568, 53.2877249],
            [-7.5104703, 53.2877207],
            [-7.5109307, 53.2876912],
            [-7.5111908, 53.2876691],
            [-7.5114736, 53.2876155],
            [-7.5116551, 53.2875871],
            [-7.51251, 53.2874532],
            [-7.5127939, 53.2874086],
            [-7.5129609, 53.2877285],
            [-7.5140204, 53.2878419],
            [-7.5167936, 53.2875017],
            [-7.5169304, 53.2873659],
            [-7.5168524, 53.2864647],
            [-7.5168459, 53.285757],
            [-7.5178078, 53.2856026],
            [-7.5172158, 53.2829334],
            [-7.516154, 53.2824816],
            [-7.5161978, 53.2815324],
            [-7.5139675, 53.2805489],
            [-7.5112663, 53.278971],
            [-7.5099909, 53.2780167],
            [-7.5089967, 53.2771877],
            [-7.5071327, 53.2757563],
            [-7.5078391, 53.2732303],
            [-7.5085103, 53.2729778],
            [-7.5089904, 53.2730973],
            [-7.5093284, 53.2731605],
            [-7.509603, 53.2732144],
            [-7.5098015, 53.2732364],
            [-7.5099445, 53.2732365],
            [-7.5103288, 53.273208],
            [-7.5113146, 53.2730656],
            [-7.5121072, 53.2729164],
            [-7.5135287, 53.2727072],
            [-7.5143682, 53.2725404],
            [-7.5151284, 53.2724583],
            [-7.5161508, 53.2723739],
            [-7.5167683, 53.2722238],
            [-7.5173375, 53.2718552],
            [-7.5178095, 53.2715097],
            [-7.5191361, 53.2710143],
            [-7.5205025, 53.2706528],
            [-7.5210549, 53.270627],
            [-7.521057, 53.2704556],
          ],
        ],
      },
    };
  }

  async addressDetail(query) {
    //
    return this.ApiRequest('https://nominatim.openstreetmap.org/search', { ...query,polygon_geojson: 1, dedupe: 1, namedetails: 0, extratags: 1, addressdetails: 1, format: 'json'  });
  }
}

export default new MapService();
